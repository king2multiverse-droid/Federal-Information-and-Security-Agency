<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Federal Information & Security Agency</title>
<style>
  body {
    background: black;
    color: #00ff88;
    font-family: monospace;
    margin: 0;
    padding: 10px;
  }
  #terminal {
    white-space: pre-wrap;
  }
  #input {
    display: inline;
  }
</style>
</head>
<body>

<div id="terminal"></div>
<span id="prompt">&gt; </span><span id="input"></span>

<script>
/* =========================
   CONFIG
========================= */
const API_URL = "https://script.google.com/macros/s/AKfycbyJDDsj4Ow8o-sbN3mPIb2sPn76ubIe-rNvKMZoEhBric-yId1yGHDQKThvXelrZag/exec";

/* =========================
   STATE
========================= */
let buffer = "";
let loggedIn = false;
let terminalUnlocked = true; // allow token typing only

const terminal = document.getElementById("terminal");
const input = document.getElementById("input");

/* =========================
   TERMINAL UTIL
========================= */
function print(text = "") {
  terminal.textContent += text + "\n";
  window.scrollTo(0, document.body.scrollHeight);
}

function clearScreen() {
  terminal.textContent = "";
}

/* =========================
   ACCESS CONTROL
========================= */
function denyAccess(msg) {
  clearScreen();
  print("************************************************************");
  print("*                  FEDERAL SECURITY NOTICE                 *");
  print("************************************************************");
  print("");
  print(msg);
  print("");
  print("SESSION TERMINATED");
  terminalUnlocked = false;
}

/* =========================
   INITIAL SCREEN
========================= */
clearScreen();
print("************************************************************");
print("*                  FEDERAL SECURITY NOTICE                 *");
print("************************************************************");
print("");
print("THIS TERMINAL IS THE PROPERTY OF A FEDERAL AUTHORITY.");
print("");
print("ENTER AUTHORIZATION TOKEN TO CONTINUE.");
print("");

/* =========================
   TOKEN VALIDATION
========================= */
function validateEnteredToken(token) {
  print("VALIDATING TOKEN...");

  fetch(`${API_URL}?token=${encodeURIComponent(token)}`)
    .then(r => r.json())
    .then(res => {
      if (res.ok) {
        loggedIn = true;

        clearScreen();
        print("SECURITY HANDSHAKE COMPLETE");
        print("WELCOME, AGENT " + res.codename);
        print("");
        showMainMenu();
      } else {
        print("SECURITY VALIDATION FAILED");
      }
    })
    .catch(() => {
      print("SECURITY LINK FAILURE");
    });
}

/* =========================
   MAIN MENU
========================= */
function showMainMenu() {
  print("=== MAIN MENU ===");
  print("1. Federal Disciplinary Council");
  print("2. Federation Operations");
  print("3. Restricted Sector");
  print("");
  print("TYPE OPTION NUMBER OR 'MENU'");
}

/* =========================
   INPUT HANDLER
========================= */
document.addEventListener("keydown", e => {
  if (!terminalUnlocked) return;

  if (e.key === "Enter") {
    print("> " + buffer);
    const cmd = buffer.trim().toUpperCase();

    if (!loggedIn) {
      validateEnteredToken(cmd);
    } else {
      if (cmd === "MENU") {
        clearScreen();
        showMainMenu();
      } else {
        print("UNRECOGNIZED COMMAND");
      }
    }

    buffer = "";
    input.textContent = "";
    return;
  }

  if (e.key === "Backspace") {
    buffer = buffer.slice(0, -1);
  } else if (e.key.length === 1) {
    buffer += e.key.toUpperCase();
  }

  input.textContent = buffer;
});
</script>

<script>
window.addEventListener("load", () => {
  const params = new URLSearchParams(window.location.search);
  const token = params.get("token");

  console.log("TOKEN:", token);

  if (!token) {
    denyAccess("NO TOKEN PROVIDED");
    return;
  }

  fetch(`${API_URL}?token=${encodeURIComponent(token)}`)
    .then(r => r.json())
    .then(res => {
      if (res.ok) {
        loggedIn = true;
        terminalUnlocked = true;

        clearScreen();
        print("SECURITY HANDSHAKE COMPLETE");
        print("WELCOME, AGENT " + res.codename);
        print("");
        showMainMenu();
      } else {
        denyAccess("SECURITY VALIDATION FAILED");
      }
    })
    .catch(() => {
      denyAccess("SECURITY LINK FAILURE");
    });
});
</script>
</body>
</html>

